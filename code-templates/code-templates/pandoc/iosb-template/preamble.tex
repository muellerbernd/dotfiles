% If you don't intent to use pictures in the first and last frame, you can remove the following two lines
\RequirePackage{tikz} % (tikz is needed for absolute placement independent of aspect ratio)
\usetikzlibrary{calc, positioning}

% Don't edit the text below

% No monospace font for URLs
\RequirePackage{url}
\urlstyle{same}

\RequirePackage{xcolor}
\RequirePackage{ifthen}

% interpret empty string for pictures as undefined
\newcommand{\undefineEmpty}[1]{
    \ifdefined#1
        \ifthenelse{\equal{#1}{}}{
            \let #1 \undefined
        }{}
    \fi
}
\undefineEmpty{\titleimage}
\undefineEmpty{\lastimage}

\ifthenelse{ % If aspect ratio is 4:3
    \lengthtest{\dimexpr\paperwidth*254/7227\relax=12.8pt}
    \AND
    \lengthtest{\dimexpr\paperheight*254/7227\relax=9.6pt}
}{ % define dimensions specific to 4:3 aspect ratio
    \def\frametitlev{2.5mm}
    \def\framesubtitlev{1mm}
    \def\bottompicscale{1.3}
    \def\footerdp{6mm}
    \def\footerht{7mm}

    % scale down font
    \def\fontscale{0.8}

    % set global margins
    \setbeamersize{text margin left=7mm,text margin right=5mm}
    \def\beamerleftmargin{7mm}
}{ % define geometry specific to 16:9/16:10 aspect ratio
    \def\frametitlev{0mm}
    \def\framesubtitlev{2.5mm}
    \def\bottompicscale{1}
    \def\footerdp{5mm}
    \def\footerht{6mm}

    % increase margins
    \def\fontscale{1}
    \renewcommand{\baselinestretch}{1.1}

    % set margin for itemize
    \let\olditemize=\itemize
    \let\endolditemize=\enditemize
    \renewenvironment{itemize}{\olditemize \itemsep1mm \parskip1mm}{\endolditemize}

    % set margin for enumerate
    \let\oldenum=\enumerate
    \let\endoldenum=\endenumerate
    \renewenvironment{enumerate}{\oldenum \itemsep1mm \parskip1mm}{\endoldenum}

    % set margin for description
    \let\olddescr=\description
    \let\endolddescr=\enddescription
    \renewenvironment{description}{\olddescr \itemsep1mm \parskip1mm}{\endolddescr}

    % set global margins
    \setbeamersize{text margin left=8mm,text margin right=5mm}
    \def\beamerleftmargin{8mm}
}

\ifdefined\titlesize\else
    \def\titlesize{18}
\fi
\ifdefined\subtitlesize\else
    \def\subtitlesize{13}
\fi

\ifdefined\Umathchardef
    % If XeLaTeX or LuaTeX, setup fontspec
    % First try Arial, then Helvetica and TeX Gyre Heros, last fallback option is Liberation Sans
    \usepackage{fontspec}
    \IfFontExistsTF{Arial} {
        \setsansfont[
            Ligatures=TeX,
            Scale=\fontscale,
            BoldFont={Arial Bold},
            ItalicFont={Arial Italic},
            BoldItalicFont={Arial Bold Italic}
        ]{Arial}
    }{
        \IfFontExistsTF{Helvetica} {
            \setsansfont[
                Ligatures=TeX,
                Scale=\fontscale,
                BoldFont={Helvetica Bold},
                ItalicFont={Helvetica Italic},
                BoldItalicFont={Helvetica Bold Italic}
            ]{Helvetica}
        }{
            \IfFontExistsTF{TeX Gyre Heros} {
                \setsansfont[
                    Ligatures=TeX,
                    Scale=\fontscale,
                    BoldFont={TeX Gyre Heros Bold},
                    ItalicFont={TeX Gyre Heros Italic},
                    BoldItalicFont={TeX Gyre Heros Bold Italic}
                ]{TeX Gyre Heros}
            }{
                \setsansfont[
                    Ligatures=TeX,
                    Scale=\fontscale,
                    BoldFont={Liberation Sans Bold},
                    ItalicFont={Liberation Sans Italic},
                    BoldItalicFont={Liberation Sans Bold Italic}
                ]{Liberation Sans}
            }
        }
    }
\else
    % if fontspec is not available, include the font packages accordingly
    \usepackage[T1]{fontenc}
    % Only use arial if installed, else fall back to hevetica
    \IfFileExists{uarial.sty}{
        \RequirePackage[scaled=\fontscale]{uarial}
    }{
        \RequirePackage[scaled=\fontscale]{helvet}
    }
\fi

% Define picture placement on first and last frame (not intended to be used manually)
\newcommand{\bottompic}[2]{
    \usebackgroundtemplate{
        \begin{tikzpicture}[remember picture,overlay]
            \node[text width=\paperwidth, anchor=south west,inner sep=0pt] (A) at ($(current page.south west)+(-0.2pt,\dimexpr{\footerdp + \footerht + 0.4mm})$) {
                \includegraphics[width=\bottompicscale\paperwidth]{#1} % Include picture
            };
            \node[text width=\paperwidth](B)[above=0 mm of A]{ % Add text above picture
                \hspace{\beamerleftmargin}\parbox{0.9\textwidth}{
                    \textcolor{TUIl-grey}{\tiny #2}
                }
            };
        \end{tikzpicture}
    }
}

% User commands
% Creates the titlepage (Extra command needed because bottompic needs to be set before creating the frame)
% \newcommand{\titleframe}{
%     {
%         \ifdefined\titleimage
%             \bottompic{\titleimage}{} %<- Don't change this
%         \fi
%         \frame {
%             \titlepage
%         }
%     }
% }

\newcommand{\titleframe}[3]{
    {
            \begin{frame}[plain]
                \titlepage
                % Betreuer: #1
                % Betreuender Hochschullehrer: #2
                \vspace{5mm}

                \begin{table}[ht]
                    \centering
                    \begin{tabular}{ll}
                        Betreuer: & #1                                        \\
                                  & #2                                        \\[2mm]
                        \multicolumn{2}{l}{Verantwortlicher Hochschullehrer:} \\
                                  & #3                                        \\[2cm]
                    \end{tabular}
                \end{table}
            \end{frame}
        }
}


\newcommand{\imageframe}[6][TUIl-orange]{
    {
            % Set background picture
            \usebackgroundtemplate{
                \vbox to \paperheight{
                    \vspace{-#6}
                    \hspace{\dimexpr #5 - 0.8mm \relax}
                    \includegraphics[width=#4\paperwidth]{#2}
                }
            }
            % Set color of the title
            \setbeamercolor{frametitle}{fg=#1}

            % Create frame
            \frame{
                \frametitle{#3}
            }
        }
}

% \newcommand{\lastframe}[3]{
%     {
%         % Redefine subtitle (unset bfseries)
%         \setbeamerfont{framesubtitle}{size*={9}{11}\selectfont\normalfont}
%         \ifdefined\lastimage
%             \bottompic{\lastimage}{#3}
%         \fi
%
%         % Redefine frame title to have a larger gap between title and subtitle
%         \setbeamertemplate{frametitle}{
%             \vspace{\frametitlev}
%           \usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}\insertframetitle
%
%           \vspace{5mm}
%           \usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle
%         }
%
%         % Create frame
%         \frame{
%             \ifdefined\lastimage
%                 \frametitle{#1}
%                 \framesubtitle{#2}
%             \else
%                 \usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}#1
%                 \vspace{5mm}
%
%                 \usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}#2
%             \fi
%         }
%     }
% }

\newcommand{\lastframe}[2]{
    {
            % Redefine subtitle (unset bfseries)
            \setbeamerfont{framesubtitle}{size*={9}{11}\selectfont\normalfont}

    % Create frame
    \frame{
        % \centering
        \usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}#1
        \vspace{5mm}
        \usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}#2


    }
}
}


\newcommand{\frametblcontent}[2]{
    % % Redefine subtitle (unset bfseries)
    % \setbeamerfont{framesubtitle}{size*={9}{11}\selectfont\normalfont}

    % Create frame
    \frame{
        % \centering
        % \begin{minipage}{0.45\textwidth}
        %     \frametitle{#1}
        % \end{minipage}
        % \hfill
        % \begin{minipage}{0.45\textwidth}
        %     \tiny
        %     \tableofcontents[
        %         currentsubsection,
        %         hideothersubsections,
        %         sectionstyle=show/hide,
        %         subsectionstyle=show/shaded,
        %     ]
        % \end{minipage}

        \frametitle{#1}
        % \ifdefempty{\subsecname}{\relax}{%
        \begin{tikzpicture}[remember picture,overlay]
            \node[text width=5cm, anchor=north east,draw=black!80] (A) at ($(current page.north east)-(5pt,5pt)$) {
                \tiny
                \tableofcontents[
                    currentsubsection,
                    hideothersubsections,
                    sectionstyle=show/hide,
                    subsectionstyle=show/shaded,
                ]

            };
        \end{tikzpicture}
        % }%
        #2
    }
}

\newcommand{\picframe}[3]{
    % % Redefine subtitle (unset bfseries)
    % \setbeamerfont{framesubtitle}{size*={9}{11}\selectfont\normalfont}

    % Create frame
    \frame{
        % \centering
        % \begin{minipage}{0.45\textwidth}
        %     \frametitle{#1}
        % \end{minipage}
        % \hfill
        % \begin{minipage}{0.45\textwidth}
        %     \tiny
        %     \tableofcontents[
        %         currentsubsection,
        %         hideothersubsections,
        %         sectionstyle=show/hide,
        %         subsectionstyle=show/shaded,
        %     ]
        % \end{minipage}

        \frametitle{#1}
        % \ifdefempty{\subsecname}{\relax}{%
        \begin{tikzpicture}[remember picture,overlay]
            \node[anchor=north east] (A) at ($(current page.north east)-(3pt,3pt)$) {
                \includegraphics[height=4cm,keepaspectratio]{#2}

            };
        \end{tikzpicture}
        % }%
        \vspace{2cm}
        #3
    }
}


\newcommand{\titlefont}[1]{
    \textcolor{TUIl-blue}{\textbf{#1}}
}

%%%%%%%%%%%%%color
\definecolor{TUIl-orange}{RGB}{255, 121, 0}
\definecolor{TUIl-blue}{RGB}{0, 51, 89}
\definecolor{TUIl-green}{RGB}{0, 116, 122}
\definecolor{TUIl-grey}{RGB}{165, 165, 165}

% = Font Colors =
% background
\setbeamercolor*{background canvas}{bg=white}

% title/subtitle
\setbeamercolor{frametitle}{fg=TUIl-orange}
\setbeamercolor{framesubtitle}{fg=TUIl-blue}

% text
\setbeamercolor*{normal text}{fg=TUIl-blue}

% itemize
\setbeamercolor*{itemize item}{fg=TUIl-orange}
\setbeamercolor*{itemize subitem}{fg=TUIl-blue}
\setbeamercolor*{itemize subsubitem}{fg=TUIl-blue}

% enumerate
\setbeamercolor*{enumerate item}{fg=TUIl-orange}
\setbeamercolor*{enumerate subitem}{fg=TUIl-blue}
\setbeamercolor*{enumerate subsubitem}{fg=TUIl-blue}

% block colors/style
\setbeamercolor{block body}{fg=TUIl-blue,bg=TUIl-blue!10!bg}
\setbeamercolor{block title}{parent=structure,fg=white,bg=TUIl-blue}
\setbeamertemplate{blocks}[rounded][shadow=false]

% alert
\setbeamercolor{alerted text}{fg=TUIl-orange}

% footer
\setbeamercolor*{footer}{bg=white, fg=TUIl-grey}
\setbeamercolor*{page number in head/foot}{fg=TUIl-grey}

% bibliography
\setbeamercolor{bibliography entry author}{fg=TUIl-blue}
\setbeamercolor{bibliography entry title}{fg=TUIl-blue}
\setbeamercolor{bibliography entry journal}{fg=TUIl-blue}
\setbeamercolor{bibliography entry note}{fg=TUIl-blue}

% bullet points for itemize
\defbeamertemplate{itemize item}{image}{\tiny \raisebox{0.5ex}{$\bullet$}}
\defbeamertemplate{itemize subitem}{image}{\tiny \raisebox{0.5ex}{$\bullet$}}
\defbeamertemplate{itemize subsubitem}{image}{\tiny \raisebox{0.5ex}{$\bullet$}}

\setbeamertemplate{itemize item}[image]
\setbeamertemplate{itemize subitem}[image]
\setbeamertemplate{itemize subsubitem}[image]

% bibliography icons
\setbeamertemplate{bibliography item}{\lower3.5pt\hbox{\hskip2pt\scalebox{0.7}{\pgfuseimage{beamericonarticle}}\hskip1pt}}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
% frame title
\setbeamertemplate{frametitle}{
    \vspace{\frametitlev}
    \usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}\insertframetitle

    \vspace{\framesubtitlev}
    \usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle
}

% title page
\setbeamertemplate{title page}
{
    \ifdefined\titleimage
        \frametitle{\inserttitle}
        \framesubtitle{\insertsubtitle}
    \else
        \begin{center}
            \usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}\inserttitle

            \vspace{\framesubtitlev}
            \usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertsubtitle

            \vspace{1.5mm}
            \insertauthor\\
            {\scriptsize\insertinstitute}\\~\\
            {\small\insertdate}
        \end{center}
    \fi
}

\setbeamertemplate{sections/subsections in toc}[circle]

\setbeamertemplate{part page}[default][colsep=-4bp,rounded=true]
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Remove beamer navigation bar
\beamertemplatenavigationsymbolsempty

% \setbeamertemplate{headline}{%
%     % \begin{beamercolorbox}[colsep=1.5pt]{upper separation line head}
%     % \end{beamercolorbox}
%     % \begin{beamercolorbox}{section in head/foot}
%     %       \insertnavigation{\paperwidth}
%     % \end{beamercolorbox}%
%     \ifbeamer@theme@subsection%
%         \begin{beamercolorbox}[colsep=1.5pt]{middle separation line head}
%         \end{beamercolorbox}
%         \begin{beamercolorbox}[]{subsection in head/foot}
%             % \usebeamerfont{subsection in head/foot} \hfill\insertsubsectionhead
%             \usebeamerfont{subsection in head/foot}\hfill\tableofcontents[
%                 currentsubsection,
%                 hideothersubsections,
%                 sectionstyle=show/hide,
%                 subsectionstyle=show/shaded,
%             ]
%         \end{beamercolorbox}%
%     \fi%
%     % \begin{beamercolorbox}[colsep=1.5pt]{lower separation line head}
%     % \end{beamercolorbox}
% }

% footer/footline definition
\setbeamertemplate{footline}{
    \color{TUIl-green}{\rule{\textwidth}{0.3pt}} % Draw line
    \begin{beamercolorbox}[wd=\textwidth, dp=\footerdp, ht=\footerht]{footer}
        \begin{minipage}[t]{0.125\paperwidth} % Page number
            \hspace{7mm}
            \insertpagenumber
        \end{minipage}
        \begin{minipage}[t]{0.4\paperwidth} % Footer content
            \footercontent
        \end{minipage}
        \hfill
        \begin{minipage}[t]{15mm} % Logo
            \vspace{-2mm}
            % \includegraphics[width=15mm]{./images/Logo_IOSB.jpg}
        \end{minipage}
        \hfill
        \begin{minipage}[t]{42mm} % Logo
            \vspace{-5mm}
            % \includegraphics[scale=.6]{./images/tuil-logo.pdf}
        \end{minipage}
    \end{beamercolorbox}
}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[ngerman]{babel}
\usepackage[utf8]{inputenc}
% \usepackage{biblatex}
\usepackage[backend=biber,style=numeric-comp,sorting=none]{biblatex}
\usepackage{csquotes}
\addbibresource{slides.bib}
\usepackage{graphicx}
\usepackage[inkscapearea=page]{svg}
\usepackage{amssymb}
% TIKZ stuff
\usepackage{tikz}
\usetikzlibrary{trees,positioning,shapes,shadows,arrows}
\tikzset{
    basic/.style  = {draw, text width=8cm, drop shadow, font=\footnotesize, rectangle},
    root/.style   = {basic, rounded corners=2pt, thin, align=center, fill=white, text width=4cm},
    level-2/.style = {basic, rounded corners=6pt, thin,align=center, fill=white, text width=4cm},
    level-3/.style = {basic, thin, align=center, fill=white, text width= 3.0cm},
    level-4/.style = {basic, thin, align=right, fill=white, text width= 2.0cm}
}

\tikzstyle{samodule} = [rectangle, rounded corners,text centered, draw=black, fill=red!30]
\tikzstyle{mlp} = [rectangle, text centered, draw=black, fill=green!30]
\tikzstyle{globalsamodule} = [rectangle, text centered, draw=black, fill=blue!30]
\tikzstyle{fpmodule} = [trapezium, trapezium angle=83.5, text centered, draw=black, fill=yellow!30]
\tikzstyle{arrow} = [thick,->,>=stealth]

\usepackage{geometry}

% \usepackage{pgfgantt}
% \newganttchartelement{orangebar}{
%     orangebar/.style={
%             % inner sep=0pt,
%             draw=orange!66!black,
%             thick,
%             top color=orange!15,
%             bottom color=orange!15
%         },
%     % orangebar label font=\slshape,
%     % orangebar left shift=.1,
%     % orangebar right shift=-.1
% }
%
% \newganttchartelement{bluebar}{
%     bluebar/.style={
%             inner sep=0pt,
%             draw=blue!66!black,
%             thick,
%             top color=blue!15,
%             bottom color=blue!15
%         },
%     % bluebar label font=\slshape,
%     % bluebar left shift=.1,
%     % bluebar right shift=-.1
% }
%
% \newganttchartelement{graybar}{
%     graybar/.style={
%             inner sep=0pt,
%             draw=gray!66!black,
%             thick,
%             top color=gray!15,
%             bottom color=gray!15
%         },
%     % bluebar label font=\slshape,
%     % bluebar left shift=.1,
%     % bluebar right shift=-.1
% }

\usepackage[edges]{forest}
\forestset{%
dir tree switch forking/.style args={at #1}{%
for tree={
        font=\sffamily,
        fit=rectangle,
    },
where level=#1{
for tree={
        folder,
        grow'=0,
    },
delay={
child anchor=north,
!u.parent anchor=south,
edge path'={(!u.parent anchor) -- ++(0,-\forestoption{fork sep}) -| (.child anchor)}
},
}{
if={level()<(#1)}{
        forked edge,
        parent anchor=children,
        child anchor=parent,
    }{},
},
before typesetting nodes={
        for tree={
                content/.wrap value={\strut ##1},
            },
        if={isodd(n_children("!r"))}{
                for nodewalk/.wrap pgfmath arg={{fake=r,n=##1}{calign with current edge}}{int((n_children("!r")+1)/2)},
            }{},
    },
},
node title/.style={
        content={\textbf{#1}},
    },
node descriptor/.style={content+={\\#1}},
title splitter/.style={
        before typesetting nodes={
                split option={content}{:}{node title,node descriptor},
            },
    },
title split/.style={
        for tree={title splitter},
    },
}
\usetikzlibrary{shadows,arrows.meta}

\tikzset{
    parent/.style={align=center,text width=5cm,fill=gray!10,rounded corners=2pt},
    child/.style={align=center,text width=2.8cm,fill=white,rounded corners=2pt},
    grandchild/.style={align=center,fill=white,text width=2.3cm},
    pt3d/.style={align=center,fill=green!10,text width=2.3cm}
}
\tikzset{
    invisible/.style={opacity=0,text opacity=0},
    visible on/.style={alt=#1{}{invisible}},
    alt/.code args={<#1>#2#3}{%
            \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
        },
}
\forestset{
visible on/.style={
for tree={
/tikz/visible on={#1},
edge+={/tikz/visible on={#1}}}}}

\usepackage{todonotes}
\usepackage{hyperref}
\usepackage{url}
\usepackage{siunitx}                    % für einheitliche Angabe von Einheiten
\usepackage{tcolorbox}
\usepackage{tabularx}
\usepackage{tabularray}
\usepackage{svg}
\usepackage{nicematrix}
\usepackage{rotating} % Rotating table
\usepackage[export]{adjustbox}
\usepackage{float}
\usepackage{xltabular}
\usepackage{threeparttable}
\usepackage{booktabs, caption, makecell}
\usepackage{chngpage}
\usepackage{multirow}

% Die folgenden Definitionen definieren den Pfad für die Bilder, die in der ersten und letzten Folie verwendet werden.
% Um die Bilder zu entfernen, können die Definitionen auskommentiert werden. Autor, Datum und Institut werden in der
% Titelfolie nur angezeigt, wenn kein Bild für 'titleimage' verwendet wird.
% \def\titleimage{images/humbold.jpg}
% \def\lastimage{images/campus.jpg}

% Folgende Definitionen können verwendet werden, um die Schriftgröße für Title und Subtitle der Folien manuell festzulegen
% \def\titlesize{18}
% \def\subtitlesize{13}

% Definiere den Inhalt der unteren Zeile (Standard: Name der aktuellen Sektion)
% \def\footercontent{\insertsection}
% Komplexeres Beispiel mit Sektion, Autor und aktuellem Datum
\def\footercontent{\begin{tabular}{c|c|c}
        \insertsection & \insertauthor & \insertdate
    \end{tabular}}

\usepackage[absolute,overlay]{textpos}

\setbeamercolor{framesource}{fg=gray}
\setbeamerfont{framesource}{size=\tiny}

\newcommand{\source}[1]{\begin{textblock*}{4cm}(8.7cm,8.6cm)
        \begin{beamercolorbox}[ht=0.5cm,right]{framesource}
            \usebeamerfont{framesource}\usebeamercolor[fg]{framesource} Source: {#1}
        \end{beamercolorbox}
    \end{textblock*}}

% Es wird empfohlen, Arial als Schriftart zu verwenden. Dafür ist die Installation des Pakets 'urw-arial' nötig.
% Sollte das Paket nicht installiert sein, wird Helvetica verwendet.

% Für Nutzer von XeLaTeX und LuaTeX wird automatisch fontspec zur Auswahl der passenden Schriftart verwendet.
% Sollten die vorgeschlagenen Einstellungen nicht anwendbar sein, können sie an der entsprechenden Stelle in beamerthemeTUIl.sty geändert werden.

% Um mit verschiedenen Seitenverhältnissen kompatibel zu sein, werden die Bilder auf der ersten und letzten Folie unterschiedlich skaliert:
% Für 4:3:                              width=1.3\textwidth
% Für alle anderen Seitenverhältnisse:  width=1.0\textwidth
%
% Um eine feste Skalierung für die Bilder zu verwenden, kann folgende Zeile verwendet werden:
% \def\bottompicscale{1}

% \AtBeginSection[]
% {
%     \begin{frame}
%         \frametitle{Gliederung}
%         \tableofcontents[currentsection]
%     \end{frame}
% }

\NewDocumentEnvironment{itemizewithimage}{ m b }{%
    \begin{minipage}[t][3cm][t]{\textwidth}
        \begin{itemize}%
            #2
        \end{itemize}%
    \end{minipage}
    \vfill%
    % \hrule
    \begin{center}%
        % \includegraphics[height=3cm,width=\textwidth,keepaspectratio]{#1}%
        \includegraphics[height=3cm,width=4cm]{#1}%
    \end{center}%
}{%
}

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatother
